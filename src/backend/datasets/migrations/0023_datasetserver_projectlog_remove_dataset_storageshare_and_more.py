# Generated by Django 4.2.13 on 2025-03-14 08:28

from django.db import migrations, models
import django.db.models.deletion
from django.db.models import F


def move_ptype_toproj(a, s):
    Proj = a.get_model('datasets', 'Project')
    OldPT = a.get_model('datasets', 'ProjType')
    ptype_map = {x.project_id: x.ptype_id for x in OldPT.objects.all()}
    for proj in Proj.objects.all():
        proj.ptype_id = ptype_map[proj.pk]
        proj.save()


def fake(a, s):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('rawstatus', '0032_msfiledata'),
        ('datasets', '0022_sampleprepparameter_sampleprepparameteroption_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='ProjectLog',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateTimeField(auto_now_add=True)),
                ('level', models.IntegerField(choices=[(1, 'Opened'), (2, 'Closed'), (3, 'Info'), (4, 'Security'), (5, 'Critical')])),
                ('message', models.TextField()),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='datasets.project')),
            ],
        ),
        migrations.AddField(
            model_name='project',
            name='externalref',
            field=models.TextField(default=''),
            preserve_default=False,
        ),
        migrations.AddField(
            model_name='project',
            name='ptype',
            field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.CASCADE, to='datasets.projecttypename'),
            preserve_default=False,
        ),

        migrations.RunPython(move_ptype_toproj, fake),

        migrations.DeleteModel(
            name='ProjType',
        ),

        migrations.AddField(
            model_name='dataset',
            name='securityclass',
            field=models.IntegerField(choices=[(1, 'Not classified')], default=1),
            preserve_default=False,
        ),
    ]
